#!/bin/bash

echo -e "\nChecking for Git installation..."
if [[ -z $(git -v) ]]; then
    echo -e "\nGit is not installed. Installing Git...\n"
    sudo apt update && sudo apt install -y git
else
    echo -e "Git is already installed."
fi

if [[ -d ".ssh" ]]; then
    HAS_SSH_KEY_LOOP="false"
    while [[ $HAS_SSH_KEY_LOOP == "false" ]]; do
    echo ""
        read -p "You already have a ssh key do you want to overwrite it? (y or n): " SSH_KEY
        case $SSH_KEY in
            [Nn]*) HAS_SSH_KEY_LOOP="true"
            break ;;
            [Yy]*) ssh-keygen -t ed25519
            echo -e "\n$(cat ~/.ssh/id_ed25519.pub)\nPaste this key on your GitHub profile --> https://github.com/settings/keys"
            HAS_SSH_KEY_LOOP="true"
            break ;;
            *) echo -e "Please answer y or n\n" ;;
        esac
    done
else
    echo -e "\nCreating a ssh key..."
    ssh-keygen -t ed25519
    echo -e "\n$(cat ~/.ssh/id_ed25519.pub)\n\nPaste this key on your GitHub profile --> https://github.com/settings/keys"
fi

if [[ -f ".gitconfig" ]]; then
    echo -e "\nHere is the current content of your .gitconfig file:"
    echo -e "\n$(cat ~/.gitconfig)\n"
    OVERWRITE_GITCONFIG_LOOP="false"
    while [[ $OVERWRITE_GITCONFIG_LOOP == "false" ]]; do
        read -p "Do you agree to overwrite your .gitconfig ? (y or n) : " CHOICE
        case $CHOICE in
            [Yy]*) OVERWRITE_GITCONFIGE_LOOP="true"
            read -p "Enter your GitHub email to log in : " EMAIL
            read -p "Enter your GitHub name to log in : " NAME
            git config --global user.name "$NAME"
            git config --global user.email "$EMAIL"
            echo ".gitconfig has been updated."
            break ;;
            [Nn]*) OVERWRITE_GITCONFIG_LOOP="true"
            echo "No changes were made to your .gitconfig file"
            break ;;
            *) echo -e "Please answer y or n\n" ;;
        esac
    done
else
    echo -e "\nConfiguring a .gitconfig file..."
    read -p "Enter your GitHub email to log in : " EMAIL
    read -p "Enter your GitHub name to log in : " NAME
    git config --global user.name "$NAME"
    git config --global user.email "$EMAIL"
    echo "Your .gitconfig file has been created"
fi

if [[ -f ".bash_profile" ]]; then
    echo -e "\nHere is the current content of your .bash_profile file:"
    echo -e "\n$(cat ~/Repository_Manager/.bash_profile)\n"
    OVERWRITE_BASH_PROFILE_LOOP="false"
    while [[ $OVERWRITE_BASH_PROFILE_LOOP == "false" ]]; do
        read -p "Do you agree to overwrite your .bash_profile ? (y or n) : " CHOICE
        case $CHOICE in
            [Yy]*) OVERWRITE_BASH_PROFILE_LOOP="true"
            echo ".bash_profile has been updated."
            cp ~/Repository_Manager/.bash_profile ~/.bash_profile
            break ;;
            [Nn]*) OVERWRITE_BASH_PROFILE_LOOP="true"
            echo "No changes were made to your .bash_profile file"
            break ;;
            *) echo -e "Please answer y or n\n" ;;
        esac
    done
else
    echo -e "\nCreating a new .bash_profile..."
    cp ~/Repository_Manager/.bash_profile ~/.bash_profile
    echo "Your .bash_profile file has been created"
fi
echo ""
